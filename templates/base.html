<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>{% if title %}{{ title }} Â· {% endif %}{{ app_name or "Watermark Studio" }}</title>
    <script>
      (function () {
        try {
          var t = localStorage.getItem("wm_theme");
          if (t) document.documentElement.setAttribute("data-theme", t);
        } catch (e) {}
      })();
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css', v=static_version) }}" />
    {% block head %}{% endblock %}
  </head>
  <body>
    <canvas id="bgParticles" class="bg_particles" aria-hidden="true"></canvas>
    <div class="container">
	      <div class="shell">
	        <aside class="sidebar">
	          <a class="brand" href="{{ url_for('main.index') }}" title="{{ app_name or 'Watermark Studio' }}">
	            <div class="logo" aria-hidden="true" style="--logo-image: url('{{ url_for('static', filename='img/logo.svg', v=static_version) }}');"></div>
	            <div class="brand_text">
	              <h1>{{ app_name or "Watermark Studio" }}</h1>
	              <div class="sub">PDF / å›¾ç‰‡æ°´å°ï¼šæ·»åŠ ã€å»é™¤ã€é¢„è§ˆã€ä¸‹è½½</div>
	            </div>
	          </a>

          <nav class="nav">
            <a href="{{ url_for('main.index') }}" class="{% if active == 'home' %}active{% endif %}" title="é¦–é¡µ">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 10.5 12 4l8 6.5V20a1 1 0 0 1-1 1h-5v-7H10v7H5a1 1 0 0 1-1-1v-9.5z"/></svg>
              <span>é¦–é¡µ</span>
            </a>
            <a href="{{ url_for('pdf.studio_page') }}" class="{% if active == 'pdf' %}active{% endif %}" title="PDF æ°´å°">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 3h7l5 5v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm7 1.5V9h4.5L14 4.5zM9 13h6v2H9v-2zm0 4h6v2H9v-2z"/></svg>
              <span>PDF</span>
            </a>
            <a href="{{ url_for('image.studio_page') }}" class="{% if active == 'img' %}active{% endif %}" title="å›¾ç‰‡æ°´å°">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6zm2 0v8.5l3.2-3.2a1 1 0 0 1 1.4 0L14 14.7l1.6-1.6a1 1 0 0 1 1.4 0L18 14.1V6H6zm0 12h12v-1.1l-1.7-1.7-1.6 1.6a1 1 0 0 1-1.4 0L10 13.4 6 17.4V18z"/></svg>
              <span>å›¾ç‰‡</span>
            </a>
            <a href="{{ url_for('image.annotate_page') }}" class="{% if active == 'img_annotate' %}active{% endif %}" title="UI æ ‡æ³¨">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 5h14a2 2 0 0 1 2 2v4h-2V7H5v12h6v2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2zm9 8 7-7 1.4 1.4-7 7L14 15v-2zm-2 2h2v2h-2v-2zm2 0h2v2h-2v-2z"/></svg>
              <span>æ ‡æ³¨</span>
            </a>
            <a href="{{ url_for('video.studio_page') }}" class="{% if active == 'video' %}active{% endif %}" title="è§†é¢‘è§£æ">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2.5l4-2.3a1 1 0 0 1 1.5.9v8.8a1 1 0 0 1-1.5.9l-4-2.3V18a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6zm12 2v8l4 2.3V5.7L16 8z"/></svg>
              <span>è§†é¢‘</span>
            </a>
            <a href="{{ url_for('image.compress_page') }}" class="{% if active == 'img_compress' %}active{% endif %}" title="å›¾ç‰‡å‹ç¼©">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7zm2 0v10h12V7H6zm2 2h8v2H8V9zm0 4h5v2H8v-2z"/></svg>
              <span>å‹ç¼©</span>
            </a>
            <a href="{{ url_for('image.slice_page') }}" class="{% if active == 'img_slice' %}active{% endif %}" title="å›¾ç‰‡åˆ‡åˆ†/æ‹¼è£…">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 5h7v7H4V5zm9 0h7v7h-7V5zM4 12h7v7H4v-7zm9 4h7v3h-7v-3z"/></svg>
              <span>åˆ‡åˆ†</span>
            </a>
            <a href="{{ url_for('webapp.pack_page') }}" class="{% if active == 'webapp_pack' %}active{% endif %}" title="ç½‘ç«™æ‰“åŒ… App">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 4h12a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-4l1.5 3H8.5L10 17H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm0 2v9h12V6H6z"/></svg>
              <span>æ‰“åŒ…</span>
            </a>
          </nav>
        </aside>

        <main class="main">
          <header class="topbar">
            <div class="topbar_left">
              <div class="topbar_title">{{ title or (app_name or "Watermark Studio") }}</div>
              <div class="topbar_subtitle">{% if active == 'home' %}ä½ çš„å·¥å…·é›†åˆæ¦‚è§ˆ{% endif %}</div>
            </div>
            <div class="topbar_center">
              <div class="topbar_search" role="search">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M10.5 3a7.5 7.5 0 1 1 4.6 13.4l3.7 3.7-1.4 1.4-3.7-3.7A7.5 7.5 0 0 1 10.5 3zm0 2a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11z"/></svg>
                <input type="text" placeholder="æœç´¢å·¥å…·â€¦" aria-label="æœç´¢å·¥å…·" />
              </div>
            </div>
            <div class="topbar_right">
              <div class="theme_switcher">
                <select id="themeSelect" aria-label="ä¸»é¢˜">
                  <option value="default">é»˜è®¤</option>
                  <option value="light">æµ…è‰²</option>
                  <option value="midnight">æš—å¤œ</option>
                  <option value="emerald">ç¥–æ¯ç»¿</option>
                  <option value="rose">æ¨±èŠ±</option>
                </select>
              </div>
              <a class="btn primary btn_sm" id="addExternalToolBtn" href="#">+ æ·»åŠ å¤–é“¾</a>
            </div>
          </header>
          {% block content %}{% endblock %}
        </main>
      </div>

      <div id="toolModalBackdrop" class="modal_backdrop" style="display:none;">
        <div id="toolModal" class="modal" role="dialog" aria-modal="true" aria-label="æ·»åŠ å¤–é“¾å·¥å…·" onclick="event.stopPropagation()">
          <div class="modal_hd">
            <div id="toolModalTitle" class="modal_title">æ·»åŠ å¤–é“¾å·¥å…·</div>
            <a class="btn secondary btn_sm" href="#" data-modal-close>å…³é—­</a>
          </div>
          <div class="modal_bd">
            <form id="toolModalForm">
              <div class="cols" style="gap: 10px;">
                <div class="col-12">
                  <div class="field">
                    <label>åç§°</label>
                    <input type="text" name="name" placeholder="ä¾‹å¦‚ï¼šéœ€æ±‚æ–‡æ¡£ / è®¾è®¡ç¨¿ / API å¹³å°" required />
                  </div>
                </div>
                <div class="col-12">
                  <div class="field">
                    <label>å¤–é“¾åœ°å€</label>
                    <input type="text" name="url" placeholder="https://..." required />
                    <div class="hint">ä»…æ”¯æŒ http/https å¤–é“¾ã€‚</div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="field">
                    <label>åˆ†ç±»</label>
                    <select name="category">
                      <option value="dev">å¼€å‘å·¥å…·</option>
                      <option value="design">è®¾è®¡å·¥å…·</option>
                      <option value="other">å…¶å®ƒ</option>
                    </select>
                  </div>
                </div>
                <div class="col-6">
                  <div class="field">
                    <label>å›¾æ ‡ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" name="icon" placeholder="ğŸ”— / å­—æ¯ / ä¸¤ä¸ªå­—ç¬¦" />
                  </div>
                </div>
                <div class="col-12">
                  <div class="field">
                    <label>ç®€ä»‹ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea name="description" class="annot_json" style="height: 140px; min-height: 110px;" placeholder="ä¸€å¥è¯è¯´æ˜è¿™ä¸ªå¤–é“¾åšä»€ä¹ˆ"></textarea>
                  </div>
                </div>
                <div class="col-12">
                  <label style="display:flex; gap:10px; align-items:center;">
                    <input type="checkbox" name="open_new_tab" checked />
                    <span class="muted">åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€</span>
                  </label>
                </div>
              </div>
              <div class="row" style="justify-content: space-between; margin-top: 10px;">
                <div id="toolModalStatus" class="muted"></div>
                <div class="row">
                  <a class="btn secondary" href="#" data-modal-close>å–æ¶ˆ</a>
                  <button class="btn primary" type="submit">ä¿å­˜</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div id="deleteModalBackdrop" class="modal_backdrop" style="display:none;">
        <div id="deleteModal" class="modal" style="max-width: 400px;" role="dialog" aria-modal="true" aria-label="ç¡®è®¤åˆ é™¤" onclick="event.stopPropagation()">
          <div class="modal_hd">
            <div class="modal_title">ç¡®è®¤åˆ é™¤</div>
            <a class="btn secondary btn_sm" href="#" data-delete-modal-close>å…³é—­</a>
          </div>
          <div class="modal_bd">
            <p id="deleteModalMessage" style="margin: 0 0 20px; color: var(--text);">ç¡®å®šåˆ é™¤è¯¥é¡¹ç›®ï¼Ÿ</p>
            <div class="row" style="justify-content: flex-end;">
              <a class="btn secondary" href="#" data-delete-modal-close>å–æ¶ˆ</a>
              <button id="deleteModalConfirm" class="btn primary" style="background: var(--danger); border-color: var(--danger);" type="button">åˆ é™¤</button>
            </div>
          </div>
        </div>
      </div>

      <footer class="footer">
        <span class="pill">æœ¬å·¥å…·ä»…åœ¨æœ¬åœ°å¤„ç†æ–‡ä»¶</span>
        <span class="pill">é»˜è®¤ä¸Šé™ 50MB</span>
      </footer>
    </div>

    <script src="{{ url_for('static', filename='js/theme.js', v=static_version) }}"></script>
    <script src="{{ url_for('static', filename='js/particles.js', v=static_version) }}"></script>
    <script src="{{ url_for('static', filename='js/drag_drop_upload.js', v=static_version) }}"></script>
    <script src="{{ url_for('static', filename='js/external_tools.js', v=static_version) }}"></script>
    <script>
      setupExternalToolModal({
        openBtn: "#addExternalToolBtn",
        modal: "#toolModal",
        backdrop: "#toolModalBackdrop",
        closeBtns: "[data-modal-close]",
        form: "#toolModalForm",
        status: "#toolModalStatus",
        title: "#toolModalTitle",
        redirectTo: {{ url_for('main.index') | tojson }},
        endpoints: {
          add: {{ url_for('main.tools_add') | tojson }},
          updateBase: {{ url_for('main.tools_update', tool_id='__id__') | tojson }},
          deleteBase: {{ url_for('main.tools_delete', tool_id='__id__') | tojson }},
        },
      });
    </script>
  </body>
</html>
